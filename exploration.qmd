---
title: "Titre de votre page d'exploration"
title-block-banner: false
description: | 
  Petite description de cette page.
# à changer
date: "2022-12-21"
# Modifier les détails que vous voulez
author:
  - name: "Alfred Assal"
    # Votre site web perso ou github
    url: https://github.com/AlfredAssal/FAS1002_projet-final
    # les champs d'affiliation sont optionnels, vous pouvez les
    # comment out en ajoutant un # devant.
    affiliation: FAS1002
    affiliation-url: https://FAS1002.github.io/A22
    # changer pour votre propre orcid id
    # https://orcid.org/ pour vous inscrire.
    orcid: 0000-0002-5510-6473

# TRUE == Générer une citation pour cette page précise. Pour enlever, mettre false.
citation: true
# Inclure les références que vous utilisez dans vos rapports. Je conseille Zotero pour construire
# ce fichier ou de connecter RStudio directement pour pouvoir citer avec @nom-de-reference.
bibliography: references.bib
---

```{r}
library(tidyverse)
library(countrycode)
library(gsheet)
library(psych)
library(lubridate)
library(doBy)

library(purrr)

```

# Téléchargement des données

```{r}

# Téléchargement de énergie
currentDate <- Sys.Date()
csvFileName <- paste("data/raw/energie",currentDate,".csv",sep = "")
download.file("https://nyc3.digitaloceanspaces.com/owid-public/data/energy/owid-energy-data.csv",destfile = csvFileName)

# Téléchargement de gapminder
csvFileName2 <- paste("data/raw/gapminder",currentDate,".csv",sep = "")

url_gap <- "https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/edit#gid=176703676"

dat_gap <- read.csv(text=gsheet2text(url_gap, format='csv'), stringsAsFactors=FALSE)

write.csv(dat_gap,csvFileName2) 


```

# Données

```{r}

#Données sur l'energie
thedate <- Sys.Date()
thefileEN <- paste0("data/raw/energie",thedate,".csv")
dat_energie <- read.csv(thefileEN)



```

# Nettoyages des données

```{r}


# Combinaisons des deux bases de données

colnames(dat_gap)[2] <- "country"
colnames(dat_gap)[3] <- "year"

dat <- left_join(dat_gap, dat_energie)

# Transformations des données concernant les continants.
dat$continent <- countrycode(sourcevar = dat[, "geo"],
                             origin = "iso3c",
                             destination = "continent")

dat$continent <-
    ifelse(dat$iso_code == 'ATA', "Antartica" , dat$continent)
dat$continent <-
    ifelse(dat$iso_code == 'ANT', "Americas" , dat$continent)

dat$continent <- ifelse(dat$country == 'Asia', "Asia" , dat$continent)
dat$continent <-
    ifelse(str_detect(dat$country, "Africa"), "Africa" , dat$continent)
dat$continent <-
    ifelse(dat$country == 'Europe', "Europe" , dat$continent)

table(dat$continent, useNA = "always")
unique(dat$continent)

# Création des variables catégorielle pour les contients
dat$continentCat <- ifelse(dat$continent == "Africa", 1, dat$continent)

dat$continentCat <-
    ifelse(dat$continent == "Americas", 2, dat$continentCat)

dat$continentCat <-
    ifelse(dat$continent == "Antartica", 3, dat$continentCat)

dat$continentCat <- ifelse(dat$continent == "Asia", 4, dat$continentCat)

dat$continentCat <- ifelse(dat$continent == "Europe", 5, dat$continentCat)

dat$continentCat <- ifelse(dat$continent == "Oceania", 6, dat$continentCat)

# Création du premier tableau de statistiques descriptive
dat_production <- dat %>%
    subset(year>=2000,select = c(country,
                                 continent,
                                 energy_per_capita,
                                 coal_production,
                                 gas_production,
                                 oil_production,
                                 hydro_electricity,
                                 solar_electricity,
                                 wind_electricity,
                                 renewables_electricity,
                                 other_renewable_electricity))
 

dat_production<-dat_production[!is.na(dat_production$continent),]

tab1 <- dat_production %>%
  group_by(as.factor(continent)) %>%
   summarize(
       n=n(),
       Moyenne = mean(energy_per_capita,na.rm = TRUE),
       SD = sd(energy_per_capita,na.rm = TRUE),
       Min = min(energy_per_capita,na.rm = TRUE),
       Max = max(energy_per_capita,na.rm = TRUE)
       )

dat <- dat %>%
  mutate(quinqua = as.numeric(year) - as.numeric(year) %% 50)

tab2 <- dat %>%
    group_by(as.factor(quinqua)) %>% 
     summarize(
       n=n(),
       Moyenne = mean(Life.expectancy,na.rm = TRUE),
       SD = sd(Life.expectancy,na.rm = TRUE),
       Min = min(Life.expectancy,na.rm = TRUE),
       Max = max(Life.expectancy,na.rm = TRUE)
       )

dat_growth <- dat %>% 
    select(c(gdp,
             gas_production,
             coal_production,
             oil_production,
             ))

tab3 <- describe(dat_growth, fast = T)

df <- data.frame(grpBy=dat$continent, dat$gdp, dat$electricity_demand, dat$electricity_generation, dat$gas_prod_change_pct, dat$Life.expectancy) %>% split(.$grpBy) %>% map(summary)

```

## Statistiques descriptives

```{r}

# Consommation d'énergie par capita, regroupé par continent au 21e siècle.
tab1

# Statistiques descriptive sur la durée de vie par quinquagénaire
tab2

# Statistiques intertemporelles sur la production des énergies les plus importante

tab3 

# Statistiques descriptives par continant
df
```

# Analyse

## Analyse 1

```{r}

modele1 <- lm(data = dat, gdp ~ oil_production + gas_production + coal_production + nuclear_electricity + hydro_electricity+other_renewable_electricity+solar_electricity+wind_electricity)

options(scipen = 999)
summary(modele1)

```

Dans ma première analyse, je voulais voir l'effet statistique de la production de pétrole sur le PIB. L'hypothèse était bien sûr que le la production de pétrole affecte énormément le PIB. Dans le modèle de régression ci-dessous j'ai utilisé un modèle de régression multiple avec comme régresseur principal la production de pétrole. J'ai ensuite contrôlé pour toutes les autres variables de production d'énergie. Le choix des variables de contrôle vient principalement du fait que je ne voulais pas surestimer l'effet de la production de pétrole en faisant passer l'effet des variables omises dans l'effet de la production de pétrole.

Comme il est possible de le voir dans le modèle de régression, une augmentation de la production de pétrole d'un térawatt cause une augmentation statistique du PIB de 106 878 253 323. Bien sûr, ce chiffre est à prendre à la légère, j\'expliquerai plus tard les biais potentiels. Ensuite, le R^2^ de 0.9393 signifie que 93% de la proportion du PIB est expliqué par le modèle de régression. De plus, les valeurs sont toutes significatives au seuil de 2% d\'intervalle de confiance.

Comme mentionné plus haut, il y a plusieurs biais potentiels dans ce modèle, j\'en citerais seulement quelques-uns, puisque la liste peut être longue. Le premier type de biais est le biais par variables omises. Pour essayer d\'expliquer l\'effet de la production de pétrole sur le PIB, il me faudrait plusieurs autres variables, par exemple une variable sur la démocratie pourrait être utile dans le modèle. Aussi, j\'utilise des données en panel entre les années 1800 et 2050, ainsi pour avoir un modèle plus précis, une bonne idée serait de contrôler pour les effets fixes. De cette façon, j\'atténue l\'effet du biais temporel.

Étonnamment, l'énergie solaire et l'énergie éolienne affectent beaucoup plus le PIB que je pensais. Cependant, je pense qu'il y a aussi un léger biais dans ce cas, puisque les pays ayant le plus d'installation éoliens sont des pays occidentaux principalement développés. Alors, puisque le modèle voit seulement l'effet sur les pays plus riches, il sur estime l'effet éolien et l'effet solaire.

Enfin, ce modèle est seulement une corrélation, il n\'est d\'en aucun cas un modèle causal, il est seulement statistiquement significatif. Il n\'est pas possible de dire avec un modèle aussi simple qu\'une augmentation de la production de pétrole d\'un térawatt cause une augmentation du PIB de 106 878 253 323\$.

Bien sûr, en réalité la production de pétrole affecte positivement le PIB et la tendance du modèle est probablement juste, cependant il n'est rien possible de dire d'autre.

```{r map}

library(leaflet)
leaflet() %>%
    setView(lng=150,
            lat=-30,
            zoom = 3) %>%
    addTiles() %>%
    addMarkers(lng=174.768,
               lat=-36.852,
               popup="Là où R est né") %>%
    addProviderTiles(providers$Esri.WorldGrayCanvas)
```

## Peut-être que ça vous inspirera!

```{r plotly, message=FALSE, warning=FALSE}

library(plotly)
library(gapminder)
df <- gapminder

fig <- df %>%
  plot_ly(
    x = ~ gdpPercap,
    y = ~ lifeExp,
    size = ~ pop,
    color = ~ continent,
    frame = ~ year,
    text = ~ country,
    hoverinfo = "text",
    type = 'scatter',
    mode = 'markers',
    width = "100%",
    height = 600
  )

fig <- fig %>% layout(xaxis = list(type = "log"))

fig <- fig %>%
  animation_button(
    x = 0, xanchor = "left", y = -0.15, yanchor = "bottom"
  )
fig
```

------------------------------------------------------------------------

À votre imagination de jouer!
